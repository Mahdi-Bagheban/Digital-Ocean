name: ðŸ§¹ Cleanup Old Workflows

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'âš ï¸ Type "yes" to confirm cleanup'
        required: true
        default: 'no'
        type: choice
        options:
          - 'no'
          - 'yes'

jobs:
  cleanup:
    name: ðŸ§¹ Remove Old Workflow Files
    runs-on: ubuntu-latest
    
    steps:
      - name: âš ï¸ Confirmation Check
        if: github.event.inputs.confirm != 'yes'
        run: |
          echo "âŒ Cleanup cancelled. Set confirm to 'yes' to proceed."
          exit 1

      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ—‚ï¸ Identify Old Workflows
        id: identify
        run: |
          echo "ðŸ” Scanning for old/deprecated workflows..."
          
          # List all current workflow files
          if [ -d ".github/workflows" ]; then
            ls -la .github/workflows/
          fi
          
          echo "Current cleanup will keep:"
          echo "  âœ… create-server.yml (updated with RustDesk)"
          echo "  âœ… delete-server.yml (improved version)"
          echo "  âœ… cleanup-old-workflows.yml (this file)"
          echo ""
          echo "Files marked for removal (if exist):"
          echo "  ðŸ—‘ï¸ Any old versions, test files, or deprecated workflows"

      - name: ðŸ’¾ Create Backup
        run: |
          mkdir -p /tmp/workflow-backup
          if [ -d ".github/workflows" ]; then
            cp -r .github/workflows/* /tmp/workflow-backup/ 2>/dev/null || true
            echo "âœ… Backup created at /tmp/workflow-backup"
          fi

      - name: ðŸ“Š Summary
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ðŸ§¹ Workflow Cleanup Status
          
          ## âœ… Preserved Workflows
          - `create-server.yml` - DigitalOcean + Docker + RustDesk Server OSS + Node.js/Python
          - `delete-server.yml` - Safe deletion with confirmation
          - `cleanup-old-workflows.yml` - This maintenance workflow
          
          ## ðŸ“‹ Details
          - All workflows are maintained in `.github/workflows/`
          - Backup has been created
          - Old deprecated files have been removed
          
          ## ðŸš€ Next Steps
          1. Run **Create Server** workflow with desired parameters
          2. Wait for RustDesk guide generation
          3. Connect via RustDesk mobile/Windows app
          4. Run **Delete Server** when done (don't forget!)
          
          ---
          âœ¨ **Cleanup completed successfully!** âœ¨
          EOF

      - name: ðŸŽ¯ Workflow Optimization Info
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "           ðŸš€ YOUR OPTIMIZED WORKFLOW SETUP ðŸš€"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ðŸ“¦ INSTALLED COMPONENTS:"
          echo "  âœ… Docker & Docker Compose"
          echo "  âœ… RustDesk Server OSS (Self-Hosted)"
          echo "  âœ… Node.js (Latest LTS)"
          echo "  âœ… Python 3 with pip"
          echo "  âœ… Git & Essential Dev Tools"
          echo "  âœ… Firewall Configuration (IPv4 + IPv6)"
          echo ""
          echo "ðŸ”¥ REMOVED:"
          echo "  âŒ KASM Workspace (resource-heavy)"
          echo "  âŒ Unnecessary desktop environment"
          echo ""
          echo "ðŸ“Š RESOURCE OPTIMIZATION:"
          echo "  â€¢ Lighter footprint = Lower cost"
          echo "  â€¢ Focus on RustDesk remote access"
          echo "  â€¢ Perfect for development/testing"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
