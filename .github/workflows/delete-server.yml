name: ðŸ—‘ï¸ Delete Development Server

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: 'âš ï¸ Type "yes" to confirm deletion (Ø¨Ø±Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ "yes" ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯)'
        required: true
        default: 'no'
        type: choice
        options:
          - 'no'
          - 'yes'

jobs:
  delete-server:
    runs-on: ubuntu-latest
    
    steps:
      - name: âš¡ Confirmation Check
        if: github.event.inputs.confirm != 'yes'
        run: |
          echo "âŒ Deletion cancelled. You must select 'yes' to confirm."
          exit 1
      
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4
      
      - name: ðŸ”§ Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y jq bc curl
      
      - name: ðŸ“¤ Download Server Information
        uses: actions/download-artifact@v4
        with:
          name: server-info
        continue-on-error: true
      
      - name: ðŸ” Configure Environment
        run: |
          echo "DO_API_TOKEN=${{ secrets.DO_API_TOKEN }}" > .env
      
      - name: ðŸ—‘ï¸ Delete Server
        run: |
          chmod +x delete-server.sh
          # Auto-confirm deletion with 'yes'
          echo "yes" | ./delete-server.sh
      
      - name: ðŸ“Š Summary Report
        if: always()
        run: |
          echo "## âœ… Server Successfully Deleted" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Your development server has been removed from DigitalOcean." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’° **Cost Calculation:**" >> $GITHUB_STEP_SUMMARY
          echo "The final cost will be calculated based on usage duration." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ‘€ Check your DigitalOcean dashboard for billing details." >> $GITHUB_STEP_SUMMARY
