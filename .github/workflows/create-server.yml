# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸš€ DigitalOcean Server + RustDesk Server OSS Automation Workflow v11.0     â•‘
# â•‘                                                                            â•‘
# â•‘ ğŸ“ Purpose: Complete server setup with RustDesk remote access             â•‘
# â•‘ ğŸ‰ Features: Docker + RustDesk + Node.js + Python + Auto-Guide Generation â•‘
# â•‘ ğŸ‘¤ Author: Mahdi Bagheban                                                  â•‘
# â•‘ ğŸ“… Updated: December 2025 (v11.0 - CRITICAL FIXES)                       â•‘
# â•‘ ğŸ”§ Fixes: SSH handling, RustDesk timing, release tags                    â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸš€ Create DigitalOcean Server with RustDesk

on:
  workflow_dispatch:
    inputs:
      server_name:
        description: 'ğŸ“ Server Name | Ù†Ø§Ù… Ø³Ø±ÙˆØ±'
        required: true
        default: 'rustdesk-server'
        type: string

      region:
        description: 'ğŸŒ Region | Ù…Ù†Ø·Ù‚Ù‡ Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ'
        required: true
        default: 'fra1'
        type: choice
        options:
          - 'fra1 - ğŸ‡©ğŸ‡ª Frankfurt (Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†)'
          - 'ams3 - ğŸ‡³ğŸ‡± Amsterdam (Ù‡Ù„Ù†Ø¯)'
          - 'lon1 - ğŸ‡¬ğŸ‡§ London (Ø§Ù†Ú¯Ù„ÛŒØ³)'
          - 'nyc1 - ğŸ‡ºğŸ‡¸ New York (Ø¢Ù…Ø±ÛŒÚ©Ø§)'
          - 'sfo3 - ğŸ‡ºğŸ‡¸ San Francisco (Ú©Ø§Ù„ÛŒÙØ±Ù†ÛŒØ§)'
          - 'sgp1 - ğŸ‡¸ğŸ‡¬ Singapore (Ø¢Ø³ÛŒØ§)'

      size_slug:
        description: 'ğŸ’ª Server Plan | Ù¾Ù„Ù† Ø³Ø±ÙˆØ±'
        required: true
        default: 's-1vcpu-512mb-10gb'
        type: choice
        options:
          - 's-1vcpu-512mb-10gb - ğŸŒ± Nano ($4/mo) - ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª'
          - 's-2vcpu-4gb-intel - ğŸŒ± Small ($26/mo) - ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡'
          - 's-4vcpu-8gb-intel - ğŸ”¥ Standard ($52/mo)'
          - 'm-2vcpu-16gb - ğŸ‘‘ High Memory ($98/mo)'
          - 'm-8vcpu-64gb-intel - ğŸš€ Extra Large ($435/mo)'

jobs:
  create-server:
    name: ğŸ—ï¸ Create & Setup Server
    runs-on: ubuntu-latest
    timeout-minutes: 45
    outputs:
      droplet_id: ${{ steps.create.outputs.droplet_id }}
      ipv4: ${{ steps.info.outputs.ipv4 }}
      ipv6: ${{ steps.info.outputs.ipv6 }}

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Install Required Tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y jq curl bc qrencode 2>&1 | grep -E "(Setting|^Get:|^Reading)" || true
          echo "âœ… Tools installed: jq, curl, bc, qrencode"

      - name: ğŸ”‘ Get SSH Key ID
        id: ssh_key
        run: |
          echo "ğŸ” Searching for SSH Key: ${{ secrets.SSH_KEY_NAME }}"
          
          response=$(curl -s -X GET \
            -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            "https://api.digitalocean.com/v2/account/keys")
          
          ssh_key_id=$(echo "$response" | jq -r ".ssh_keys[] | select(.name==\"${{ secrets.SSH_KEY_NAME }}\") | .id" | head -1)
          
          if [ -z "$ssh_key_id" ] || [ "$ssh_key_id" = "null" ]; then
            echo "âŒ SSH Key not found: ${{ secrets.SSH_KEY_NAME }}"
            echo "Available SSH Keys:"
            echo "$response" | jq -r '.ssh_keys[] | "  â€¢ \(.name) (ID: \(.id))"'
            exit 1
          fi
          
          echo "ssh_key_id=$ssh_key_id" >> $GITHUB_OUTPUT
          echo "âœ… SSH Key found: $ssh_key_id"

      - name: ğŸ“ Extract Region Code
        id: region
        run: |
          region_input="${{ github.event.inputs.region }}"
          region_code=$(echo "$region_input" | cut -d' ' -f1)
          echo "region_code=$region_code" >> $GITHUB_OUTPUT
          echo "âœ… Region: $region_code"

      - name: ğŸ’¾ Extract Size Code
        id: size
        run: |
          size_input="${{ github.event.inputs.size_slug }}"
          size_code=$(echo "$size_input" | cut -d' ' -f1)
          echo "size_code=$size_code" >> $GITHUB_OUTPUT
          echo "âœ… Size: $size_code"

      - name: ğŸ—ï¸ Create Droplet
        id: create
        run: |
          echo "ğŸ—ï¸ Creating Droplet with Ubuntu 24.04..."
          
          response=$(curl -s -X POST \
            -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "name": "${{ github.event.inputs.server_name }}",
              "region": "${{ steps.region.outputs.region_code }}",
              "size": "${{ steps.size.outputs.size_code }}",
              "image": "ubuntu-24-04-x64",
              "ssh_keys": [${{ steps.ssh_key.outputs.ssh_key_id }}],
              "backups": false,
              "ipv6": true,
              "monitoring": true,
              "tags": ["github-actions", "rustdesk", "automated"]
            }' \
            "https://api.digitalocean.com/v2/droplets")
          
          droplet_id=$(echo "$response" | jq -r '.droplet.id')
          
          if [ -z "$droplet_id" ] || [ "$droplet_id" = "null" ]; then
            echo "âŒ Error creating Droplet"
            echo "$response" | jq .
            exit 1
          fi
          
          echo "droplet_id=$droplet_id" >> $GITHUB_OUTPUT
          echo "âœ… Droplet created - ID: $droplet_id"

      - name: â³ Wait for Droplet to Activate
        id: wait
        run: |
          droplet_id="${{ steps.create.outputs.droplet_id }}"
          echo "â³ Waiting for Droplet activation (max 120 seconds)..."
          
          for i in {1..60}; do
            response=$(curl -s -X GET \
              -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
              "https://api.digitalocean.com/v2/droplets/$droplet_id")
            
            status=$(echo "$response" | jq -r '.droplet.status')
            
            if [ "$status" = "active" ]; then
              echo "âœ… Droplet is ACTIVE!"
              exit 0
            fi
            
            echo "[$i/60] Status: $status - Waiting..."
            sleep 2
          done
          
          echo "âŒ Timeout: Droplet did not activate"
          exit 1

      - name: ğŸ“Š Get Server Information
        id: info
        run: |
          droplet_id="${{ steps.create.outputs.droplet_id }}"
          
          response=$(curl -s -X GET \
            -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
            "https://api.digitalocean.com/v2/droplets/$droplet_id")
          
          ipv4=$(echo "$response" | jq -r '.droplet.networks.v4[] | select(.type=="public") | .ip_address' | head -1)
          ipv6=$(echo "$response" | jq -r '.droplet.networks.v6[0].ip_address // "N/A"')
          
          echo "ipv4=$ipv4" >> $GITHUB_OUTPUT
          echo "ipv6=$ipv6" >> $GITHUB_OUTPUT
          
          echo "âœ… IPv4: $ipv4"
          echo "âœ… IPv6: $ipv6"

      - name: ğŸ¥ Health Check - Wait for SSH
        run: |
          ip="${{ steps.info.outputs.ipv4 }}"
          echo "ğŸ¥ Checking SSH availability on $ip..."
          
          for i in {1..30}; do
            if timeout 3 bash -c "echo > /dev/tcp/$ip/22" 2>/dev/null; then
              echo "âœ… SSH is ready!"
              exit 0
            fi
            echo "[$i/30] SSH not ready - waiting..."
            sleep 4
          done
          
          echo "âš ï¸ SSH check timeout (server may still be initializing)"

      - name: ğŸ”§ Create & Run Initialization Script
        id: init
        run: |
          cat > /tmp/init-server.sh << 'INIT_SCRIPT'
          #!/bin/bash
          set -e
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ INITIALIZING SERVER - RustDesk + Dev Tools Setup"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Update system
          echo "ğŸ“¦ Updating system packages..."
          sudo apt-get update -qq
          sudo apt-get upgrade -y -qq
          sudo apt-get install -y curl wget git build-essential 2>&1 | tail -1
          
          # Install Docker
          echo "ğŸ³ Installing Docker..."
          curl -fsSL https://get.docker.com -o /tmp/get-docker.sh
          sudo sh /tmp/get-docker.sh
          sudo usermod -aG docker root
          sudo systemctl start docker
          sudo systemctl enable docker
          echo "âœ… Docker installed"
          
          # Install Node.js LTS
          echo "ğŸ“¦ Installing Node.js LTS..."
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
          sudo apt-get install -y nodejs 2>&1 | tail -1
          echo "âœ… Node.js $(node -v) installed"
          
          # Install Python 3
          echo "ğŸ Installing Python 3 with dev tools..."
          sudo apt-get install -y python3 python3-pip python3-dev python3-venv 2>&1 | tail -1
          echo "âœ… Python $(python3 --version | cut -d' ' -f2) installed"
          
          # Install essential dev tools
          echo "ğŸ› ï¸ Installing development tools..."
          sudo apt-get install -y git nano vim curl wget jq htop 2>&1 | tail -1
          
          # Configure firewall
          echo "ğŸ”¥ Configuring UFW Firewall..."
          sudo apt-get install -y ufw 2>&1 | tail -1
          sudo ufw default deny incoming
          sudo ufw default allow outgoing
          sudo ufw allow 22/tcp
          sudo ufw allow 80/tcp
          sudo ufw allow 443/tcp
          sudo ufw allow 5900/tcp  # RustDesk
          sudo ufw allow 5901/tcp  # RustDesk
          sudo ufw allow 21115/tcp # RustDesk
          sudo ufw allow 21116/tcp # RustDesk
          sudo ufw allow 21117/tcp # RustDesk
          sudo ufw allow 21118/tcp # RustDesk
          sudo ufw allow 21119/tcp # RustDesk
          sudo ufw enable
          echo "âœ… Firewall configured"
          
          # Create rustdesk directory
          echo "ğŸ“ Setting up RustDesk directories..."
          sudo mkdir -p /opt/rustdesk
          sudo mkdir -p /var/log/rustdesk
          cd /opt/rustdesk
          
          # Download RustDesk Server OSS
          echo "ğŸ“¥ Downloading RustDesk Server OSS..."
          RUSTDESK_VERSION="1.41.9"
          wget -q "https://github.com/rustdesk/rustdesk-server/releases/download/$RUSTDESK_VERSION/rustdesk-server-linux-x64.zip"
          unzip -q rustdesk-server-linux-x64.zip
          rm rustdesk-server-linux-x64.zip
          
          chmod +x hbbr hbbs
          echo "âœ… RustDesk binaries downloaded and made executable"
          
          # Start RustDesk services
          echo "ğŸš€ Starting RustDesk services..."
          
          # Create systemd services
          sudo tee /etc/systemd/system/rustdesk-hbbs.service > /dev/null << 'SERVICE1'
          [Unit]
          Description=RustDesk Signal Server
          After=network.target
          
          [Service]
          Type=simple
          User=root
          WorkingDirectory=/opt/rustdesk
          ExecStart=/opt/rustdesk/hbbs
          Restart=on-failure
          RestartSec=5
          StandardOutput=journal
          StandardError=journal
          
          [Install]
          WantedBy=multi-user.target
          SERVICE1
          
          sudo tee /etc/systemd/system/rustdesk-hbbr.service > /dev/null << 'SERVICE2'
          [Unit]
          Description=RustDesk Relay Server
          After=network.target rustdesk-hbbs.service
          
          [Service]
          Type=simple
          User=root
          WorkingDirectory=/opt/rustdesk
          ExecStart=/opt/rustdesk/hbbr
          Restart=on-failure
          RestartSec=5
          StandardOutput=journal
          StandardError=journal
          
          [Install]
          WantedBy=multi-user.target
          SERVICE2
          
          sudo systemctl daemon-reload
          sudo systemctl enable rustdesk-hbbs rustdesk-hbbr
          sudo systemctl start rustdesk-hbbs rustdesk-hbbr
          
          echo "âœ… RustDesk services started"
          
          # Wait for RustDesk to initialize
          sleep 3
          
          # Extract key from id_ed25519.pub
          echo "ğŸ”‘ Extracting RustDesk key..."
          if [ -f "id_ed25519.pub" ]; then
            KEY=$(cat id_ed25519.pub | head -1)
            echo "$KEY" > /tmp/rustdesk_key.txt
            echo "âœ… RustDesk key extracted"
          else
            echo "âš ï¸ Key file will be available after first run"
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… SERVER INITIALIZATION COMPLETED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ Installed Components:"
          echo "  â€¢ Docker (container platform)"
          echo "  â€¢ Node.js $(node -v)"
          echo "  â€¢ Python $(python3 --version | cut -d' ' -f2)"
          echo "  â€¢ RustDesk Server OSS (remote access)"
          echo "  â€¢ UFW Firewall (configured & enabled)"
          echo ""
          echo "ğŸ”¥ Open Ports:"
          echo "  â€¢ 22 (SSH)"
          echo "  â€¢ 80 (HTTP)"
          echo "  â€¢ 443 (HTTPS)"
          echo "  â€¢ 5900-5901 (RustDesk UI)"
          echo "  â€¢ 21115-21119 (RustDesk Services)"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          INIT_SCRIPT
          
          chmod +x /tmp/init-server.sh
          
          echo "ğŸš€ Running initialization script on server..."
          ssh -o StrictHostKeyChecking=no \
              -o UserKnownHostsFile=/dev/null \
              -o ConnectTimeout=10 \
              root@${{ steps.info.outputs.ipv4 }} \
              'bash -s' < /tmp/init-server.sh
          
          echo "âœ… Server initialization completed!"

      - name: ğŸ” Generate RustDesk Connection Key
        id: rustdesk_key
        run: |
          echo "ğŸ”‘ Extracting RustDesk key with retry logic..."
          
          ip="${{ steps.info.outputs.ipv4 }}"
          key=""
          
          # Retry logic (1-15 attempts)
          for attempt in {1..15}; do
            key=$(ssh -o StrictHostKeyChecking=no \
                      -o UserKnownHostsFile=/dev/null \
                      -o ConnectTimeout=5 \
                      root@$ip \
                      'cat /opt/rustdesk/id_ed25519.pub' 2>/dev/null || true)
            
            if [ -n "$key" ] && [ "$key" != "" ]; then
              echo "âœ… Key extracted on attempt $attempt!"
              break
            fi
            
            echo "[$attempt/15] Waiting for key..."
            sleep 2
          done
          
          # Fallback if key not available
          if [ -z "$key" ]; then
            key="KEY_WILL_BE_GENERATED_ON_FIRST_CONNECTION"
          fi
          
          echo "rustdesk_key=$key" >> $GITHUB_OUTPUT
          echo "âœ… Key extraction complete"

      - name: ğŸ“„ Generate RustDesk Connection Guide
        id: guide
        run: |
          mkdir -p /tmp/guides
          
          ipv4="${{ steps.info.outputs.ipv4 }}"
          ipv6="${{ steps.info.outputs.ipv6 }}"
          server_name="${{ github.event.inputs.server_name }}"
          
          cat > /tmp/guides/rustdesk-connection-guide.md << "GUIDE_MD"
          # ğŸš€ RustDesk Server Connection Guide
          
          **Server Created:** $(date)
          
          ---
          
          ## ğŸ“± Server Information
          
          | Property | Value |
          |----------|-------|
          | **Server Name** | $server_name |
          | **IPv4 Address** | `$ipv4` |
          | **IPv6 Address** | `$ipv6` |
          | **RustDesk Ports** | 5900, 5901, 21115-21119 |
          | **SSH Access** | `ssh root@$ipv4` |
          
          ---
          
          ## ğŸ“¥ Installation on Android
          
          ### Step 1: Download RustDesk App
          1. Open **Google Play Store**
          2. Search for **"RustDesk"**
          3. Install the official RustDesk app
          
          ### Step 2: Add Connection
          1. Launch RustDesk app
          2. Tap the **"+" button** (Add Connection)
          3. Select **"IP Address"**
          4. Enter Server IP: `$ipv4`
          5. Tap **"Connect"**
          
          ### Step 3: Connect
          - Wait for connection prompt
          - Accept the connection on the server side
          - You're now remotely accessing the server!
          
          ---
          
          ## ğŸ’» Installation on Windows
          
          ### Step 1: Download RustDesk
          1. Go to [rustdesk.com](https://rustdesk.com)
          2. Click **"Downloads"**
          3. Download **"RustDesk.exe"** (Windows version)
          4. Run the installer
          5. Click **"Install"** and wait for completion
          
          ### Step 2: Configure Connection
          1. Open RustDesk
          2. In **"ID/IP"** field, enter: `$ipv4`
          3. Leave **ID** field empty (for IP connection)
          4. Click **"Connect"**
          
          ### Step 3: Enter Credentials
          - If prompted for password, use the credentials from server setup
          - Accept the desktop sharing request
          - You should now see the remote desktop
          
          ---
          
          ## ğŸ”§ Advanced: Using IPv6
          
          If IPv4 doesn't work, try IPv6:
          - Android: Use `$ipv6` (with brackets if needed: `[$ipv6]`)
          - Windows: Use `$ipv6` directly
          
          ---
          
          ## âš™ï¸ Configuration
          
          ### Custom ID/Password Method (Better Security)
          1. Connect to server via SSH:
             ```bash
             ssh root@$ipv4
             ```
          
          2. Configure RustDesk service for authentication
          
          3. Use ID-based connection for enhanced security
          
          ---
          
          ## ğŸš€ Server Information
          
          ### What's Installed
          - **RustDesk Server OSS** - Self-hosted remote access
          - **Docker** - Container platform
          - **Node.js** - JavaScript runtime
          - **Python 3** - Programming language
          - **UFW Firewall** - Security
          - **Ubuntu 24.04 LTS** - Operating system
          
          ### Open Ports
          ```
          22      - SSH (remote terminal)
          80      - HTTP (web)
          443     - HTTPS (secure web)
          5900    - RustDesk Display
          5901    - RustDesk Audio
          21115   - RustDesk Service
          21116   - RustDesk Service
          21117   - RustDesk Service
          21118   - RustDesk Service
          21119   - RustDesk Service
          ```
          
          ---
          
          ## â° Important: Delete Your Server When Done!
          
          **Remember:** This server costs money while running!
          
          ### How to Delete
          1. Go to GitHub Actions
          2. Run **"Delete DigitalOcean Server"** workflow
          3. Enter server name: `$server_name`
          4. Confirm deletion
          
          ---
          
          ## ğŸ“ Troubleshooting
          
          ### Connection Refused
          - Wait 2-3 minutes after server creation
          - RustDesk services may still be initializing
          - Check if port 5900 is accessible: `telnet $ipv4 5900`
          
          ### Firewall Issues
          - Ensure ports 5900-5901 and 21115-21119 are open
          - Check: `sudo ufw status`
          - Enable port: `sudo ufw allow 5900/tcp`
          
          ### Key/Certificate Issues
          - Get public key: `ssh root@$ipv4 'cat /opt/rustdesk/id_ed25519.pub'`
          - Use this key in RustDesk configuration
          
          ---
          
          **Last Updated:** $(date)
          **Server Status:** Active âœ…
          
          GUIDE_MD
          
          echo "âœ… Guide generated: /tmp/guides/rustdesk-connection-guide.md"

      - name: ğŸ“¸ Generate QR Code
        run: |
          ipv4="${{ steps.info.outputs.ipv4 }}"
          
          # Create QR code for Android quick scan
          qrencode -o /tmp/guides/rustdesk-qr-ipv4.png "$ipv4" -s 10 -m 2
          
          echo "âœ… QR code generated: /tmp/guides/rustdesk-qr-ipv4.png"

      - name: ğŸ“¦ Create Release with Guides
        id: release
        uses: softprops/action-gh-release@v1
        if: success()
        with:
          tag_name: v1.0-server-${{ steps.create.outputs.droplet_id }}-${{ github.run_id }}
          name: ğŸš€ Server "${{ github.event.inputs.server_name }}" (ID: ${{ steps.create.outputs.droplet_id }})
          body: |
            # ğŸ‰ RustDesk Server Successfully Created!
            
            ## ğŸ“Š Server Details
            - **Name:** ${{ github.event.inputs.server_name }}
            - **Droplet ID:** ${{ steps.create.outputs.droplet_id }}
            - **IPv4:** `${{ steps.info.outputs.ipv4 }}`
            - **IPv6:** `${{ steps.info.outputs.ipv6 }}`
            - **Region:** ${{ steps.region.outputs.region_code }}
            - **Size:** ${{ steps.size.outputs.size_code }}
            - **Created:** $(date)
            
            ## ğŸ“¥ Quick Start
            1. Download RustDesk from [rustdesk.com](https://rustdesk.com)
            2. Enter server IP: `${{ steps.info.outputs.ipv4 }}`
            3. Click Connect!
            
            ## ğŸ“± Downloads in This Release
            - `rustdesk-connection-guide.md` - Complete connection guide
            - `rustdesk-qr-ipv4.png` - QR code for mobile
            
            ## âš ï¸ IMPORTANT
            **Don't forget to delete this server when done!**
            
            Use the GitHub Actions "Delete DigitalOcean Server" workflow to safely remove it.
          files: |
            /tmp/guides/rustdesk-connection-guide.md
            /tmp/guides/rustdesk-qr-ipv4.png
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ“‹ Job Summary
        if: success()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'SUMMARY'
          # ğŸ‰ Server Created Successfully!
          
          ## ğŸ“Š Server Information
          
          | Property | Value |
          |----------|-------|
          | **Server Name** | `${{ github.event.inputs.server_name }}` |
          | **Droplet ID** | `${{ steps.create.outputs.droplet_id }}` |
          | **IPv4 Address** | `${{ steps.info.outputs.ipv4 }}` |
          | **IPv6 Address** | `${{ steps.info.outputs.ipv6 }}` |
          | **Region** | `${{ steps.region.outputs.region_code }}` |
          | **Size** | `${{ steps.size.outputs.size_code }}` |
          
          ## ğŸš€ Installed Components
          - âœ… **Ubuntu 24.04 LTS**
          - âœ… **Docker** - Container platform
          - âœ… **RustDesk Server OSS** - Remote access
          - âœ… **Node.js LTS** - JavaScript runtime
          - âœ… **Python 3** - Programming language
          - âœ… **UFW Firewall** - Security configured
          - âœ… **Git & Dev Tools**
          
          ## ğŸ“± Quick Connect
          
          ### Android
          1. Install **RustDesk** from Google Play Store
          2. Tap **"+"** to add connection
          3. Enter: `${{ steps.info.outputs.ipv4 }}`
          4. Tap **Connect**
          
          ### Windows
          1. Download from [rustdesk.com](https://rustdesk.com)
          2. Run installer
          3. Enter ID/IP: `${{ steps.info.outputs.ipv4 }}`
          4. Click **Connect**
          
          ## ğŸ“¥ Connection Guides
          Check the **Release** section for:
          - ğŸ“„ `rustdesk-connection-guide.md` - Full documentation
          - ğŸ“± `rustdesk-qr-ipv4.png` - QR code for mobile
          
          ## ğŸ”§ SSH Access
          ```bash
          ssh root@${{ steps.info.outputs.ipv4 }}
          ```
          
          ## âš ï¸ Important Notes
          - â³ RustDesk may take 1-2 minutes to fully initialize
          - ğŸ”¥ UFW Firewall is enabled with necessary ports open
          - ğŸ’° **Server costs money while running!**
          - ğŸ—‘ï¸ **Delete server after use to avoid charges**
          
          ## ğŸ—‘ï¸ When Done: Delete Server
          1. Go to **GitHub Actions**
          2. Run **"ğŸ—‘ï¸ Delete DigitalOcean Server"** workflow
          3. Enter server name: `${{ github.event.inputs.server_name }}`
          4. Confirm deletion
          
          **Created:** $(date)
          **Status:** âœ… **READY TO USE (v11.0 FIXED)**
          SUMMARY

      - name: ğŸš¨ Failure Summary
        if: failure()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'FAIL_SUMMARY'
          # âŒ Server Creation Failed
          
          ## ğŸ” Troubleshooting Steps
          
          1. **Check API Token**
             - Verify `DO_API_TOKEN` secret is set correctly
             - Ensure token has full permissions
          
          2. **Check SSH Key**
             - Verify SSH key name matches `SSH_KEY_NAME` secret
             - Ensure key exists in DigitalOcean account
          
          3. **Review Logs**
             - Check step logs above for specific error
             - API errors usually have helpful messages
          
          4. **Check Region/Size**
             - Verify selected region is available
             - Ensure selected size is available in that region
          
          5. **Account Status**
             - Check DigitalOcean account status
             - Verify account has sufficient credit
          
          ## ğŸ“ Common Issues
          
          - **"SSH Key not found"** â†’ Check secret name matches exactly
          - **"Invalid API Token"** â†’ Regenerate token in DigitalOcean
          - **"Timeout"** â†’ Server may have created but taking time to boot
          - **"Forbidden"** â†’ Check API token permissions
          
          Please review the logs above for the specific error message.
          FAIL_SUMMARY
