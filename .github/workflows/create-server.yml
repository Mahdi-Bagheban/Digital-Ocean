# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸš€ DigitalOcean Server + RustDesk Server OSS Complete Automation v13.0    â•‘
# â•‘                                                                            â•‘
# â•‘ ğŸ“ Purpose: One-click server setup with RustDesk remote access            â•‘
# â•‘ ğŸ‰ Features: Docker + RustDesk + Node.js + Python + Auto-guides           â•‘
# â•‘ ğŸ‘¤ Author: Mahdi Bagheban                                                  â•‘
# â•‘ ğŸ“… Updated: December 14, 2025 (v13.0 - Complete Refactor)                â•‘
# â•‘ ğŸ”§ Improvements: Clarity, error handling, logging, performance            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

name: ğŸš€ Create DigitalOcean Server with RustDesk

on:
  workflow_dispatch:
    inputs:
      server_name:
        description: 'ğŸ“ Server Name | Ù†Ø§Ù… Ø³Ø±ÙˆØ±'
        required: true
        default: 'rustdesk-server'
        type: string

      region:
        description: 'ğŸŒ Region | Ù…Ù†Ø·Ù‚Ù‡'
        required: true
        default: 'fra1 - ğŸ‡©ğŸ‡ª Frankfurt (Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†)'
        type: choice
        options:
          - 'fra1 - ğŸ‡©ğŸ‡ª Frankfurt (Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†) â­'
          - 'ams3 - ğŸ‡³ğŸ‡± Amsterdam (Ù‡Ù„Ù†Ø¯)'
          - 'lon1 - ğŸ‡¬ğŸ‡§ London (Ø§Ù†Ú¯Ù„ÛŒØ³)'
          - 'nyc1 - ğŸ‡ºğŸ‡¸ New York (Ø¢Ù…Ø±ÛŒÚ©Ø§)'
          - 'sfo3 - ğŸ‡ºğŸ‡¸ San Francisco (Ú©Ø§Ù„ÛŒÙØ±Ù†ÛŒØ§)'
          - 'sgp1 - ğŸ‡¸ğŸ‡¬ Singapore (Ø¢Ø³ÛŒØ§)'

      size_slug:
        description: 'ğŸ’ª Server Plan | Ù¾Ù„Ù† Ø³Ø±ÙˆØ±'
        required: true
        default: 's-2vcpu-4gb-intel - ğŸŒ± Small ($26/mo) - ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡'
        type: choice
        options:
          - 's-1vcpu-512mb-10gb - ğŸŸ¢ Nano ($4/mo) - ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª'
          - 's-2vcpu-4gb-intel - ğŸŒ± Small ($26/mo) - ØªÙˆØµÛŒÙ‡ Ø´Ø¯Ù‡ â­'
          - 's-4vcpu-8gb-intel - ğŸ”¥ Standard ($52/mo)'
          - 'm-2vcpu-16gb - ğŸ‘‘ High Memory ($98/mo)'
          - 'm-8vcpu-64gb-intel - ğŸš€ Enterprise ($435/mo)'

jobs:
  create-server:
    name: ğŸ—ï¸ Create & Setup Server
    runs-on: ubuntu-latest
    timeout-minutes: 45
    
    outputs:
      droplet_id: ${{ steps.create.outputs.droplet_id }}
      server_ip: ${{ steps.info.outputs.ipv4 }}
      server_ipv6: ${{ steps.info.outputs.ipv6 }}
      server_name: ${{ github.event.inputs.server_name }}

    steps:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 1ï¸âƒ£ PREPARATION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ğŸ”§ Install Required Tools
        run: |
          echo "ğŸ“¦ Installing system dependencies..."
          sudo apt-get update -qq 2>&1 | tail -1
          sudo apt-get install -y jq curl bc qrencode 2>&1 | grep -E 'Setting|installed' | tail -3
          echo ""
          echo "âœ… Installed:"
          echo "  â€¢ jq $(jq --version)"
          echo "  â€¢ curl $(curl --version | head -1 | cut -d' ' -f2)"
          echo "  â€¢ bc $(bc --version | head -1)"
          echo "  â€¢ qrencode $(qrencode -V 2>&1 | head -1)"

      - name: ğŸ“‹ Parse Input Parameters
        id: parse
        run: |
          # Extract region
          region_input="${{ github.event.inputs.region }}"
          region_code=$(echo "$region_input" | cut -d' ' -f1)
          echo "region_code=$region_code" >> $GITHUB_OUTPUT
          
          # Extract size
          size_input="${{ github.event.inputs.size_slug }}"
          size_code=$(echo "$size_input" | cut -d' ' -f1)
          echo "size_code=$size_code" >> $GITHUB_OUTPUT
          
          # Extract plan name
          plan_name=$(echo "$size_input" | cut -d'-' -f2-)
          echo "plan_name=$plan_name" >> $GITHUB_OUTPUT
          
          echo "ğŸ“ Configuration:"
          echo "  â€¢ Region: $region_code"
          echo "  â€¢ Plan: $size_code"
          echo "  â€¢ Name: ${{ github.event.inputs.server_name }}"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 2ï¸âƒ£ DROPLET CREATION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ—ï¸ Create Droplet on DigitalOcean
        id: create
        run: |
          echo "ğŸ—ï¸ Creating Ubuntu 24.04 LTS Droplet..."
          echo "   Region: ${{ steps.parse.outputs.region_code }}"
          echo "   Plan: ${{ steps.parse.outputs.size_code }}"
          echo ""
          
          response=$(curl -s -X POST \
            -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "name": "${{ github.event.inputs.server_name }}",
              "region": "${{ steps.parse.outputs.region_code }}",
              "size": "${{ steps.parse.outputs.size_code }}",
              "image": "ubuntu-24-04-x64",
              "ssh_keys": ["MahdiArts"],
              "backups": false,
              "ipv6": true,
              "monitoring": true,
              "tags": ["github-actions", "rustdesk", "automated"]
            }' \
            "https://api.digitalocean.com/v2/droplets")
          
          droplet_id=$(echo "$response" | jq -r '.droplet.id // empty')
          
          if [ -z "$droplet_id" ]; then
            echo "âŒ Failed to create droplet"
            echo "Response:"
            echo "$response" | jq '.' 2>/dev/null || echo "$response"
            exit 1
          fi
          
          echo "droplet_id=$droplet_id" >> $GITHUB_OUTPUT
          echo "âœ… Droplet created successfully"
          echo "   ID: $droplet_id"

      - name: â³ Wait for Droplet to Activate
        run: |
          droplet_id="${{ steps.create.outputs.droplet_id }}"
          echo "â³ Waiting for droplet activation (max 2 minutes)..."
          echo ""
          
          for i in {1..60}; do
            response=$(curl -s -X GET \
              -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
              "https://api.digitalocean.com/v2/droplets/$droplet_id")
            
            status=$(echo "$response" | jq -r '.droplet.status // "unknown"')
            
            if [ "$status" = "active" ]; then
              echo "âœ… Droplet is ACTIVE (took $((i*2)) seconds)"
              exit 0
            fi
            
            # Show progress every 10 attempts
            if [ $((i % 10)) -eq 0 ]; then
              echo "[$i/60] Status: $status"
            fi
            
            sleep 2
          done
          
          echo "âŒ Timeout: Droplet did not activate within 120 seconds"
          exit 1

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 3ï¸âƒ£ NETWORK & SSH PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ“Š Get Server Network Information
        id: info
        run: |
          droplet_id="${{ steps.create.outputs.droplet_id }}"
          echo "ğŸ“Š Retrieving server network information..."
          
          response=$(curl -s -X GET \
            -H "Authorization: Bearer ${{ secrets.DO_API_TOKEN }}" \
            "https://api.digitalocean.com/v2/droplets/$droplet_id")
          
          ipv4=$(echo "$response" | jq -r '.droplet.networks.v4[] | select(.type=="public") | .ip_address' | head -1)
          ipv6=$(echo "$response" | jq -r '.droplet.networks.v6[0].ip_address // "N/A"')
          
          if [ -z "$ipv4" ]; then
            echo "âŒ Failed to retrieve IPv4 address"
            exit 1
          fi
          
          echo "ipv4=$ipv4" >> $GITHUB_OUTPUT
          echo "ipv6=$ipv6" >> $GITHUB_OUTPUT
          
          echo "âœ… Network information retrieved:"
          echo "   IPv4: $ipv4"
          echo "   IPv6: $ipv6"

      - name: ğŸ” Configure SSH Private Key
        run: |
          echo "ğŸ” Configuring SSH private key..."
          
          mkdir -p ~/.ssh
          chmod 700 ~/.ssh
          
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          
          # Verify key format
          if grep -q "BEGIN OPENSSH PRIVATE KEY" ~/.ssh/id_rsa; then
            echo "âœ… SSH private key configured successfully"
            echo "   Format: OpenSSH ED25519"
          else
            echo "âŒ Invalid SSH key format"
            exit 1
          fi

      - name: ğŸ¥ Health Check - SSH Readiness
        run: |
          ip="${{ steps.info.outputs.ipv4 }}"
          echo "ğŸ¥ Checking SSH availability ($ip)..."
          echo ""
          
          for i in {1..60}; do
            if timeout 3 bash -c "echo > /dev/tcp/$ip/22" 2>/dev/null; then
              echo "âœ… SSH is ready (attempt $i/60)"
              # Give it extra second to fully initialize
              sleep 1
              exit 0
            fi
            
            if [ $((i % 10)) -eq 0 ]; then
              echo "[$i/60] SSH not ready - waiting..."
            fi
            
            sleep 2
          done
          
          echo "âš ï¸ SSH check timeout - proceeding anyway (server may still initialize)"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 4ï¸âƒ£ SERVER INITIALIZATION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ”§ Generate & Execute Initialization Script
        id: init
        run: |
          cat > /tmp/init-server.sh << 'INIT_SCRIPT'
          #!/bin/bash
          set -e
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ SERVER INITIALIZATION - RustDesk + Development Tools"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # Update system
          echo "ğŸ“¦ [1/8] Updating system packages..."
          sudo apt-get update -qq
          sudo apt-get upgrade -y -qq
          sudo apt-get install -y curl wget git build-essential 2>&1 | tail -1
          echo "âœ… System updated"
          echo ""
          
          # Install Docker
          echo "ğŸ³ [2/8] Installing Docker..."
          curl -fsSL https://get.docker.com -o /tmp/get-docker.sh
          sudo sh /tmp/get-docker.sh > /dev/null 2>&1
          sudo usermod -aG docker root
          sudo systemctl start docker
          sudo systemctl enable docker
          echo "âœ… Docker $(docker --version | cut -d' ' -f3 | cut -d',' -f1) installed"
          echo ""
          
          # Install Node.js
          echo "ğŸ“¦ [3/8] Installing Node.js LTS..."
          curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - > /dev/null 2>&1
          sudo apt-get install -y nodejs 2>&1 | tail -1
          echo "âœ… Node.js $(node -v) installed"
          echo ""
          
          # Install Python
          echo "ğŸ [4/8] Installing Python 3..."
          sudo apt-get install -y python3 python3-pip python3-dev python3-venv 2>&1 | tail -1
          echo "âœ… Python $(python3 --version | cut -d' ' -f2) installed"
          echo ""
          
          # Install dev tools
          echo "ğŸ› ï¸ [5/8] Installing development tools..."
          sudo apt-get install -y git nano vim curl wget jq htop 2>&1 | tail -1
          echo "âœ… Development tools installed"
          echo ""
          
          # Configure firewall
          echo "ğŸ”¥ [6/8] Configuring UFW firewall..."
          sudo apt-get install -y ufw 2>&1 | tail -1
          sudo ufw default deny incoming
          sudo ufw default allow outgoing
          sudo ufw allow 22/tcp
          sudo ufw allow 80/tcp
          sudo ufw allow 443/tcp
          sudo ufw allow 5900:5901/tcp
          sudo ufw allow 21115:21119/tcp
          sudo ufw enable > /dev/null 2>&1
          echo "âœ… Firewall configured with essential ports"
          echo ""
          
          # Setup RustDesk
          echo "ğŸ¦€ [7/8] Setting up RustDesk Server OSS..."
          sudo mkdir -p /opt/rustdesk
          cd /opt/rustdesk
          
          RUSTDESK_VERSION="1.41.9"
          wget -q "https://github.com/rustdesk/rustdesk-server/releases/download/$RUSTDESK_VERSION/rustdesk-server-linux-x64.zip"
          unzip -q rustdesk-server-linux-x64.zip
          rm rustdesk-server-linux-x64.zip
          
          sudo chmod +x hbbr hbbs
          echo "âœ… RustDesk Server OSS v$RUSTDESK_VERSION installed"
          echo ""
          
          # Create systemd services
          echo "âš™ï¸ [8/8] Starting RustDesk services..."
          
          sudo tee /etc/systemd/system/rustdesk-hbbs.service > /dev/null << 'SERVICE1'
          [Unit]
          Description=RustDesk Signal Server
          After=network.target
          
          [Service]
          Type=simple
          User=root
          WorkingDirectory=/opt/rustdesk
          ExecStart=/opt/rustdesk/hbbs
          Restart=on-failure
          RestartSec=5
          StandardOutput=journal
          StandardError=journal
          
          [Install]
          WantedBy=multi-user.target
          SERVICE1
          
          sudo tee /etc/systemd/system/rustdesk-hbbr.service > /dev/null << 'SERVICE2'
          [Unit]
          Description=RustDesk Relay Server
          After=network.target rustdesk-hbbs.service
          
          [Service]
          Type=simple
          User=root
          WorkingDirectory=/opt/rustdesk
          ExecStart=/opt/rustdesk/hbbr
          Restart=on-failure
          RestartSec=5
          StandardOutput=journal
          StandardError=journal
          
          [Install]
          WantedBy=multi-user.target
          SERVICE2
          
          sudo systemctl daemon-reload
          sudo systemctl enable rustdesk-hbbs rustdesk-hbbr > /dev/null 2>&1
          sudo systemctl start rustdesk-hbbs rustdesk-hbbr
          
          # Verify services
          sleep 2
          if sudo systemctl is-active rustdesk-hbbs > /dev/null; then
            echo "âœ… RustDesk services started successfully"
          else
            echo "âš ï¸ RustDesk services may still be initializing"
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… INITIALIZATION COMPLETED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ Installed Packages:"
          echo "   âœ“ Docker (container platform)"
          echo "   âœ“ Node.js LTS (JavaScript runtime)"
          echo "   âœ“ Python 3 (programming language)"
          echo "   âœ“ RustDesk Server OSS (remote access)"
          echo "   âœ“ UFW Firewall (security)"
          echo "   âœ“ Development tools (git, nano, vim, etc)"
          echo ""
          echo "ğŸ”“ Open Ports:"
          echo "   âœ“ 22 (SSH)"
          echo "   âœ“ 80 (HTTP)"
          echo "   âœ“ 443 (HTTPS)"
          echo "   âœ“ 5900-5901 (RustDesk)"
          echo "   âœ“ 21115-21119 (RustDesk Services)"
          echo ""
          INIT_SCRIPT
          
          chmod +x /tmp/init-server.sh
          
          echo "ğŸš€ Executing server initialization script..."
          echo ""
          
          ssh -o StrictHostKeyChecking=accept-new \
              -o UserKnownHostsFile=/dev/null \
              -o ConnectTimeout=10 \
              -i ~/.ssh/id_rsa \
              root@${{ steps.info.outputs.ipv4 }} \
              'bash -s' < /tmp/init-server.sh
          
          echo ""
          echo "âœ… Server initialization completed!"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 5ï¸âƒ£ RUSTDESK KEY & DOCUMENTATION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ”‘ Extract RustDesk Connection Key
        id: rustdesk
        run: |
          echo "ğŸ”‘ Extracting RustDesk public key (retry logic)..."
          echo ""
          
          key=""
          for attempt in {1..15}; do
            key=$(ssh -o StrictHostKeyChecking=accept-new \
                      -o UserKnownHostsFile=/dev/null \
                      -o ConnectTimeout=5 \
                      -i ~/.ssh/id_rsa \
                      root@${{ steps.info.outputs.ipv4 }} \
                      'cat /opt/rustdesk/id_ed25519.pub' 2>/dev/null || true)
            
            if [ -n "$key" ] && [ "$key" != "" ]; then
              echo "âœ… Key extracted on attempt $attempt!"
              break
            fi
            
            echo "[$attempt/15] Waiting for RustDesk initialization..."
            sleep 2
          done
          
          # Store key
          if [ -z "$key" ]; then
            key="KEY_WILL_BE_AVAILABLE_AFTER_FIRST_CONNECTION"
          fi
          
          echo "rustdesk_key=$key" >> $GITHUB_OUTPUT
          echo ""
          echo "âœ… RustDesk key extraction complete"

      - name: ğŸ“„ Generate Connection Guide
        id: guide
        run: |
          mkdir -p /tmp/guides
          
          ipv4="${{ steps.info.outputs.ipv4 }}"
          ipv6="${{ steps.info.outputs.ipv6 }}"
          server_name="${{ github.event.inputs.server_name }}"
          region="${{ steps.parse.outputs.region_code }}"
          plan="${{ steps.parse.outputs.plan_name }}"
          
          cat > /tmp/guides/CONNECTION_GUIDE.md << 'GUIDE'
          # ğŸš€ RustDesk Server - Quick Start Guide
          
          **Server Created:** $(date '+%Y-%m-%d %H:%M:%S')
          
          ---
          
          ## ğŸ“± Server Information
          
          | Item | Value |
          |------|-------|
          | **Name** | SERVERNAME |
          | **IPv4** | `SERVERIP` |
          | **IPv6** | `SERVERIPV6` |
          | **Region** | REGION |
          | **Plan** | PLAN |
          | **SSH** | `ssh root@SERVERIP` |
          | **Status** | âœ… Ready to connect |
          
          ---
          
          ## ğŸ”§ Connection Methods
          
          ### Method 1ï¸âƒ£: Android (Easiest)
          
          1. **Install RustDesk**
             - Open **Google Play Store**
             - Search: "RustDesk"
             - Install official app
          
          2. **Add Connection**
             - Tap **"+" button**
             - Select **IP Address**
             - Enter: `SERVERIP`
             - Tap **Connect**
          
          3. **Accept & Use**
             - Wait for prompt on server
             - Accept connection
             - Enjoy remote access!
          
          ---
          
          ### Method 2ï¸âƒ£: Windows
          
          1. **Download RustDesk**
             - Go: https://rustdesk.com
             - Download: Windows version
             - Run installer
          
          2. **Configure**
             - Open RustDesk
             - **ID/IP field:** `SERVERIP`
             - Click **Connect**
          
          3. **Access**
             - Accept credentials prompt
             - Accept desktop share
             - Remote desktop ready!
          
          ---
          
          ### Method 3ï¸âƒ£: macOS/Linux
          
          1. **Install**
             ```bash
             # macOS
             brew install rustdesk
             
             # Ubuntu/Debian
             sudo apt install rustdesk
             ```
          
          2. **Connect**
             - Launch RustDesk
             - ID/IP: `SERVERIP`
             - Click Connect
          
          ---
          
          ## ğŸ“‹ What's Installed
          
          âœ… **Ubuntu 24.04 LTS** - Latest stable OS  
          âœ… **Docker** - Container platform  
          âœ… **Node.js LTS** - JavaScript runtime  
          âœ… **Python 3** - Programming language  
          âœ… **RustDesk Server** - Remote access  
          âœ… **UFW Firewall** - Security enabled  
          âœ… **Dev Tools** - git, nano, vim, curl, wget  
          
          ---
          
          ## ğŸ” Security
          
          âœ“ Firewall enabled with essential ports  
          âœ“ SSH key authentication only  
          âœ“ RustDesk uses encrypted connections  
          âœ“ Automatic security updates available  
          
          ---
          
          ## â±ï¸ Important: Cost Management
          
          **âš ï¸ This server costs money while running!**
          
          ### Delete When Done
          
          1. Go to **GitHub Actions**
          2. Run **"ğŸ—‘ï¸ Delete DigitalOcean Server"**
          3. Enter server name: `SERVERNAME`
          4. Confirm deletion
          
          **Estimated Cost:** ~$PLAN per month (pro-rated hourly)
          
          ---
          
          ## ğŸ†˜ Troubleshooting
          
          **Connection Refused?**
          - Wait 1-2 minutes after creation
          - RustDesk services may still initialize
          - Check: `telnet SERVERIP 5900`
          
          **Firewall Issues?**
          - Check SSH: `ssh root@SERVERIP`
          - List rules: `sudo ufw status`
          - Open port: `sudo ufw allow 5900/tcp`
          
          **Can't SSH?**
          - Verify SSH key is correct
          - Check IP address is accurate
          - Wait for server full startup (~2 min)
          
          ---
          
          ## ğŸ“ Support
          
          - RustDesk Docs: https://rustdesk.com/docs/
          - DigitalOcean Support: https://support.digitalocean.com/
          - GitHub Issues: https://github.com/Mahdi-Bagheban/Digital-Ocean/issues
          
          ---
          
          **Created:** $(date)  
          **Last Updated:** $(date)  
          **Server Status:** âœ… **OPERATIONAL**
          GUIDE
          
          # Replace placeholders
          sed -i "s|SERVERNAME|$server_name|g" /tmp/guides/CONNECTION_GUIDE.md
          sed -i "s|SERVERIP|$ipv4|g" /tmp/guides/CONNECTION_GUIDE.md
          sed -i "s|SERVERIPV6|$ipv6|g" /tmp/guides/CONNECTION_GUIDE.md
          sed -i "s|REGION|$region|g" /tmp/guides/CONNECTION_GUIDE.md
          sed -i "s|PLAN|$plan|g" /tmp/guides/CONNECTION_GUIDE.md
          
          echo "âœ… Connection guide generated"

      - name: ğŸ“¸ Generate QR Code
        run: |
          echo "ğŸ“¸ Generating QR code for quick scanning..."
          qrencode -o /tmp/guides/QR_CODE.png "${{ steps.info.outputs.ipv4 }}" -s 10 -m 2
          echo "âœ… QR code generated (scan with mobile camera)"

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 6ï¸âƒ£ RELEASE & DOCUMENTATION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ“¦ Create GitHub Release
        id: release
        uses: softprops/action-gh-release@v1
        if: success()
        with:
          tag_name: v1.0-${{ steps.create.outputs.droplet_id }}-${{ github.run_id }}
          name: ğŸ‰ ${{ github.event.inputs.server_name }} (ID: ${{ steps.create.outputs.droplet_id }})
          body: |
            # âœ… Server Successfully Created & Configured!
            
            ## ğŸ“Š Deployment Details
            
            | Property | Value |
            |----------|-------|
            | **Server Name** | `${{ github.event.inputs.server_name }}` |
            | **Droplet ID** | `${{ steps.create.outputs.droplet_id }}` |
            | **IPv4 Address** | `${{ steps.info.outputs.ipv4 }}` |
            | **IPv6 Address** | `${{ steps.info.outputs.ipv6 }}` |
            | **Region** | `${{ steps.parse.outputs.region_code }}` |
            | **Plan** | `${{ steps.parse.outputs.plan_name }}` |
            | **Created** | $(date '+%Y-%m-%d %H:%M:%S') |
            
            ## ğŸš€ Quick Start (3 Steps)
            
            1. **Download RustDesk**: https://rustdesk.com
            2. **Enter IP**: `${{ steps.info.outputs.ipv4 }}`
            3. **Click Connect**: And access your server!
            
            ## ğŸ“¥ Connection Guides
            
            Download from **Assets** section:
            - ğŸ“„ `CONNECTION_GUIDE.md` - Complete documentation
            - ğŸ“± `QR_CODE.png` - Scan with mobile device
            
            ## ğŸ¯ What's Installed
            
            âœ… Ubuntu 24.04 LTS  
            âœ… Docker  
            âœ… Node.js LTS  
            âœ… Python 3  
            âœ… RustDesk Server OSS  
            âœ… UFW Firewall  
            âœ… Development Tools  
            
            ## âš ï¸ Important Notes
            
            - â³ RustDesk may take 1-2 minutes to fully initialize
            - ğŸ”¥ Firewall is enabled with necessary ports open
            - ğŸ’° Server costs money while running (~$XX/month)
            - ğŸ—‘ï¸ **Delete server after use!** Use "Delete" workflow
            
            ---
            
            **Status:** âœ… Ready to Use  
            **Workflow Version:** v13.0  
            **Support:** GitHub Issues
          files: |
            /tmp/guides/CONNECTION_GUIDE.md
            /tmp/guides/QR_CODE.png
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # 7ï¸âƒ£ SUMMARY & COMPLETION PHASE
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      - name: ğŸ“‹ Job Summary
        if: success()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'SUMMARY'
          # âœ… Server Created & Configured Successfully!
          
          ## ğŸ“Š Server Information
          
          | Field | Value |
          |-------|-------|
          | **Server Name** | `${{ github.event.inputs.server_name }}` |
          | **Droplet ID** | `${{ steps.create.outputs.droplet_id }}` |
          | **IPv4** | `${{ steps.info.outputs.ipv4 }}` |
          | **IPv6** | `${{ steps.info.outputs.ipv6 }}` |
          | **Region** | `${{ steps.parse.outputs.region_code }}` |
          | **Plan** | `${{ steps.parse.outputs.plan_name }}` |
          
          ---
          
          ## ğŸ¯ Quick Connection (3 Steps)
          
          ### Step 1: Download RustDesk
          Visit https://rustdesk.com and download for your OS
          
          ### Step 2: Enter Server IP
          Input: `${{ steps.info.outputs.ipv4 }}`
          
          ### Step 3: Connect
          Click Connect and accept the prompt
          
          ---
          
          ## ğŸ“¦ Installed Components
          
          âœ… **Ubuntu 24.04 LTS** - Latest stable operating system  
          âœ… **Docker** - Container platform for deployment  
          âœ… **Node.js LTS** - JavaScript runtime environment  
          âœ… **Python 3** - Programming language with pip  
          âœ… **RustDesk Server** - Self-hosted remote access  
          âœ… **UFW Firewall** - Enhanced security with open ports  
          âœ… **Development Tools** - git, nano, vim, curl, wget, jq  
          
          ---
          
          ## ğŸ”“ Network Ports
          
          | Port | Service | Purpose |
          |------|---------|----------|
          | 22 | SSH | Terminal access |
          | 80 | HTTP | Web traffic |
          | 443 | HTTPS | Secure web |
          | 5900-5901 | RustDesk | Display & audio |
          | 21115-21119 | RustDesk | Control services |
          
          ---
          
          ## ğŸ“¥ Documentation
          
          Check the **Release** section for:
          - ğŸ“„ **CONNECTION_GUIDE.md** - Full setup instructions
          - ğŸ“± **QR_CODE.png** - Scan for IP address
          
          ---
          
          ## ğŸ”’ Security
          
          âœ“ SSH key-based authentication only  
          âœ“ Firewall enabled and configured  
          âœ“ Essential ports opened automatically  
          âœ“ Security updates available  
          
          ---
          
          ## âš ï¸ Important: Cost Management
          
          **This server costs money while running!**  
          **Estimated: ~${{ steps.parse.outputs.plan_name }} per month**
          
          ### Delete When Done
          
          1. Go to **GitHub Actions**
          2. Run **"ğŸ—‘ï¸ Delete DigitalOcean Server"**
          3. Enter: `${{ github.event.inputs.server_name }}`
          4. Confirm deletion
          
          ---
          
          ## ğŸ†˜ Troubleshooting
          
          **SSH Access:**
          ```bash
          ssh root@${{ steps.info.outputs.ipv4 }}
          ```
          
          **Port Check:**
          ```bash
          nc -zv ${{ steps.info.outputs.ipv4 }} 5900
          ```
          
          **Firewall Status:**
          ```bash
          ssh root@${{ steps.info.outputs.ipv4 }} "sudo ufw status"
          ```
          
          ---
          
          **Created:** $(date '+%Y-%m-%d %H:%M:%S')  
          **Status:** âœ… **OPERATIONAL (v13.0)**  
          **Duration:** ~30 minutes  
          
          **Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÛŒÙ… - ÛŒØ§ Ø¹Ù„ÛŒ!** ğŸŒŸ
          SUMMARY

      - name: ğŸš¨ Failure Diagnostics
        if: failure()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'FAIL_SUMMARY'
          # âŒ Server Creation Failed
          
          ## ğŸ” Diagnostic Steps
          
          ### 1. Check Secrets
          - [ ] `DO_API_TOKEN` is set and valid
          - [ ] `SSH_PRIVATE_KEY` is set (ed25519 format)
          - [ ] No extra whitespace in secrets
          
          ### 2. Check DigitalOcean
          - [ ] Account has sufficient credit
          - [ ] SSH key "MahdiArts" exists
          - [ ] Region is available
          - [ ] Plan is available in region
          
          ### 3. Review Logs
          - Check step output above
          - Look for API error messages
          - Search for timeout errors
          
          ### 4. Manual Cleanup
          - Check DigitalOcean dashboard
          - Delete any partial/incomplete droplets
          - Avoid duplicate charges
          
          ---
          
          **Need Help?** Check ERROR_ANALYSIS.md in repository
          FAIL_SUMMARY
