name: ðŸš€ Create Development Server

on:
  workflow_dispatch:
    inputs:
      server_name:
        description: 'Ù†Ø§Ù… Ø³Ø±ÙˆØ±'
        required: false
        default: 'mahdi-dev-workspace'
      region:
        description: 'Ù…Ù†Ø·Ù‚Ù‡ Ø¯ÛŒØªØ§Ø³Ù†ØªØ±'
        required: false
        default: 'fra1'
        type: choice
        options:
          - fra1  # Frankfurt
          - ams3  # Amsterdam
          - lon1  # London
          - nyc1  # New York

jobs:
  create-server:
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Ú©Ø¯
        uses: actions/checkout@v4
      
      - name: ðŸ”§ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
        run: |
          sudo apt-get update
          sudo apt-get install -y jq bc
      
      - name: ðŸ” ØªÙ†Ø¸ÛŒÙ… Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ
        run: |
          echo "DO_API_TOKEN=${{ secrets.DO_API_TOKEN }}" > .env
          echo "SSH_KEY_NAME=${{ secrets.SSH_KEY_NAME }}" >> .env
          echo "DROPLET_NAME=${{ github.event.inputs.server_name }}" >> .env
          echo "REGION=${{ github.event.inputs.region }}" >> .env
      
      - name: ðŸš€ Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø±ÙˆØ±
        run: |
          chmod +x create-server.sh
          ./create-server.sh
      
      - name: ðŸ“¤ Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆØ±
        uses: actions/upload-artifact@v4
        with:
          name: server-info
          path: |
            .droplet_id
            .droplet_ip
            .droplet_created_at
      
      - name: ðŸ“Š Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
        run: |
          echo "## ðŸŽ‰ Ø³Ø±ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆØ±:" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø´Ù†Ø§Ø³Ù‡**: $(cat .droplet_id)" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø¢ÛŒâ€ŒÙ¾ÛŒ**: $(cat .droplet_ip)" >> $GITHUB_STEP_SUMMARY
          echo "- **Ù†Ø§Ù…**: ${{ github.event.inputs.server_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Ù…Ù†Ø·Ù‚Ù‡**: ${{ github.event.inputs.region }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”Œ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø§ØªØµØ§Ù„:" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
          echo "ssh root@$(cat .droplet_ip)" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŒ VS Code Server:" >> $GITHUB_STEP_SUMMARY
          echo "http://$(cat .droplet_ip):8080" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âš ï¸ **ØªÙˆØ¬Ù‡**: Ù†ØµØ¨ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±Ù‡Ø§ 2-5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø·ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ø´Ø¯" >> $GITHUB_STEP_SUMMARY
